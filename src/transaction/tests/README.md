# 事务模块测试说明

## 测试文件

- `TransactionTest.cpp` - 基础事务测试
- `LockManagerTest.cpp` - 锁管理器测试
- `WALTest.cpp` - WAL功能测试
- `TransactionModuleTest.cpp` - **事务模块综合测试（新增）**

## 编译和运行

### 1. 编译项目

```bash
cd /home/w/MementoDB
mkdir -p build
cd build
cmake ..
make transaction_module_test
```

### 2. 运行综合测试

```bash
./src/transaction/tests/transaction_module_test
```

或者从项目根目录：

```bash
cd build
./src/transaction/tests/transaction_module_test
```

## 测试内容

`TransactionModuleTest.cpp` 包含以下测试：

1. **基本事务生命周期**
   - 事务创建、提交、回滚
   - 事务状态查询
   - 统计信息

2. **锁管理**
   - 读锁（共享锁）
   - 写锁（排他锁）
   - 锁冲突和阻塞
   - 锁释放

3. **MVCC功能**
   - 快照创建
   - 版本写入和读取
   - 版本提交和回滚
   - 快照隔离
   - 版本统计

4. **WAL功能**
   - 事务开始日志
   - 物理更新日志
   - 事务提交日志
   - WAL统计信息

5. **死锁检测**
   - 死锁场景构建
   - 死锁检测和解决
   - 牺牲者选择

6. **并发事务**
   - 多线程并发
   - 事务隔离
   - 并发提交

7. **快照隔离**
   - 快照一致性
   - 多版本读取
   - 快照时间戳

8. **垃圾回收**
   - 版本清理
   - GC统计信息

## 预期输出

测试成功时会显示：

```
╔══════════════════════════════════════════════════════════╗
║        事务模块综合测试                                  ║
╚══════════════════════════════════════════════════════════╝

========== 测试1: 基本事务生命周期 ==========
✓ 事务创建成功
✓ 获取事务上下文成功
✓ 事务提交成功
✓ 事务回滚成功
✓ 统计信息正确

...

╔══════════════════════════════════════════════════════════╗
║                    测试总结                              ║
╠══════════════════════════════════════════════════════════╣
║  通过: 8 个测试                                    ║
║  失败: 0 个测试                                    ║
║  总计: 8 个测试                                    ║
╚══════════════════════════════════════════════════════════╝

🎉 所有测试通过！
```

## 注意事项

1. **WAL目录**：测试会在 `/tmp/mementodb_test_wal` 创建WAL文件，确保有写权限
2. **并发测试**：某些测试使用多线程，可能需要一些时间
3. **死锁检测**：死锁检测测试可能需要等待检测周期

## 调试

如果测试失败，可以：

1. 检查日志输出
2. 使用调试器运行：
   ```bash
   gdb ./build/src/transaction/tests/transaction_module_test
   ```
3. 查看具体的断言失败信息

